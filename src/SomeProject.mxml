<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx" minWidth="955" minHeight="600" width="1047" click="application1_clickHandler(event)">

	<fx:Script>
		<![CDATA[
			import utils.ImageCached;
			
			public static var CurrentAction:Number = 0;
			private static var currentImage:Image;
			private static var allObjects:Array = ['clover', 'potato', 'sunflower'];
			private static var flowerPictures:Array = ['/Image 1', '/Image 3', '/Image 5', '/Image 7', '/Image 9'];
			private static var potatoPictures:Array = ['/Images/Image 1', '/Images/Image 3'
												     , '/Images/Image 5', '/Images/Image 8', '/Images/Image 10'];
			private static var sunflowerPictures:Array = ['/Images/Image 1', '/Images/Image 3'
													    , '/Images/Image 5', '/Images/Image 7', '/Images/Image 9'];
			
			protected function button2_clickHandler(event:MouseEvent):void
			{
				// TODO Auto-generated method stub
				CurrentAction = 1;
				TextField1.text = "Сажаем клевер";
			}
			
			protected function PlantPotato_clickHandler(event:MouseEvent):void
			{
				// TODO Auto-generated method stub
				CurrentAction = 2;
				TextField1.text = "Сажаем карторшку"; 
			}
			protected function button1_clickHandler(event:MouseEvent):void
			{
				// TODO Auto-generated method stub
				CurrentAction = 3;
				TextField1.text = "Сажаем подсолнух"; 
			}
			

			protected function application1_clickHandler(event:MouseEvent):void
			{
				// TODO Auto-generated method stub
				image1_clickHandler(event);
			}
			
			//protected class point
			private function turnPoint(p:Point):Point
			{
				var cos:Number = 0.707;
				var sin:Number = 0.707;
				return new Point( int((cos*p.x-sin*p.y) * 1.9 - 130) , int((sin*p.x+cos*p.y) - 290));
			}
			private function unTurnPoint(p:Point):Point
			{
				var cos:Number = 0.707;
				var sin:Number = -0.707;
				p.x += 130;
				p.x /= 1.9;
				p.y += 290;
				return new Point( int(cos*p.x-sin*p.y) , int(sin*p.x+cos*p.y));
			}

			protected function image1_clickHandler(event:MouseEvent):void
			{
				var maxX:Number = 691; //691
				var maxY:Number = 362; //362
				var startX:Number = 64;
				var startY:Number = 57;
				var part:Number = 260; //195
				var partCount:Number = 6;
				var partX:Number = part/partCount;
				var partY:Number = part/partCount;
				var i:Number;
				var j:Number;
				var p:Point = new Point;
				var imageSrc:String = "";
				var age:Number = 4;
				switch(CurrentAction)
				{
					case 1:
						imageSrc = flowerPictures[age];
						break;
					case 2:
						imageSrc = potatoPictures[age];
						break;
					case 3:
						imageSrc = sunflowerPictures[age];
						break;
				}
				if(CurrentAction == 0)
				{
					CurrentAction = 1;
					switch(CurrentAction)
					{
						case 1:
							imageSrc = flowerPictures[age];
							break;
						case 2:
							imageSrc = potatoPictures[age];
							break;
						case 3:
							imageSrc = sunflowerPictures[age];
							break;
					}
					for(i = 0; i < partCount; i++)
					{
						for(j = 0; j < partCount; j++)
						{							
							p.x = (maxX/2) + startX + partX * i;
							p.y = startY + partY * j;
							p = turnPoint(p);
							//p = unTurnPoint(p);
							currentImage = new ImageCached();
							currentImage.source = "../assets/" + allObjects[CurrentAction - 1] + imageSrc + ".png";
							currentImage.x = p.x;
							currentImage.y = p.y;
							currentImage.width = 100;
							currentImage.scaleContent = false;
							//currentImage.load();
							TextField1.text = "" + currentImage.width;
							this.parent.addChild(currentImage);
						}
					}
					CurrentAction = 0;
				}
				if(CurrentAction > 0)
				{
					p.x = event.stageX;
					p.y = event.stageY-130;
					p = unTurnPoint(p);
					if(p.x > (maxX/2) + startX && p.x < (maxX/2) + startX + part
						&& p.y > startY && p.y < startY + part)
					{
						currentImage = new ImageCached();
						currentImage.source = "../assets/" + allObjects[CurrentAction - 1] + imageSrc + ".png";
						TextField1.text = "true" + p;
						p.x -= startX;
						p.y -= startY;
						TextField1.text = "" + int(p.x);
						p.x = int(int(p.x/partX)*partX);
						p.y = int(int(p.y/partY)*partY);
						TextField1.text += " " + p.x + " " + int(partX);
						p.x += startX;
						p.y += startY;
						p = turnPoint(p);
						currentImage.x = p.x;
						currentImage.y = p.y;
						currentImage.width = 100;
						currentImage.height = 130;
						currentImage.scaleContent = false;
						this.parent.addChild(currentImage);
					}
					else
					{
						TextField1.text = "false" + p;
					}
				}
			}

		]]>
	</fx:Script>

	<s:states>
		<s:State name="State1"/>
	</s:states>
	<fx:Declarations>
		<!-- Разместить невизуальные элементы (например, службы или объекты значений) -->
	</fx:Declarations>
	<s:Button x="881.25" y="9.9" label="Посадить картошку" width="150" id="PlantPotato" click="PlantPotato_clickHandler(event)"/>
	<s:Button x="881.25" y="38.9" label="Посадить подсолнух" width="150" click="button1_clickHandler(event)"/>
	<s:Button x="881.25" y="67.9" label="Посадить клевер" width="150" click="button2_clickHandler(event)"/>
	<s:Button x="881.25" y="96.9" label="Собрать" width="150"/>
	<s:Button x="881.25" y="125.9" label="Рости" width="150"/>
	<mx:Image x="0" y="0" source="../assets/BG.jpg" width="862" height="500" click="image1_clickHandler(event)"/>
	<s:TextInput y="154" width="144" id="TextField1" x="881"/>
	<mx:Image x="900" y="329" source="../assets/sunflower/Images/Image 9.png" scaleContent="false" width="100" height="130"/>
</s:Application>
