<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx" minWidth="955" minHeight="600" width="1047" click="application1_clickHandler(event)" activate="application1_activateHandler(event)">

	<fx:Script>
		<![CDATA[
			import mx.controls.Alert;
			
			import utils.Figure;
			import utils.ImageCached;
			import utils.MyEvents;
			
			public static var CurrentAction:Number = 0;
			private static var currentImage:Image;
			private static var arrFigures:Array = new Array;
			
			protected function button2_clickHandler(event:MouseEvent):void
			{
				// TODO Auto-generated method stub
				CurrentAction = 1;
				MyEvents.gather = false;
				TextField1.text = "Сажаем клевер";
			}
			
			protected function PlantPotato_clickHandler(event:MouseEvent):void
			{
				// TODO Auto-generated method stub
				CurrentAction = 2;
				MyEvents.gather = false;
				TextField1.text = "Сажаем карторшку"; 
			}
			protected function button1_clickHandler(event:MouseEvent):void
			{
				// TODO Auto-generated method stub
				CurrentAction = 3;
				MyEvents.gather = false;
				TextField1.text = "Сажаем подсолнух"; 
			}
			
			protected function button4_clickHandler(event:MouseEvent):void
			{
				// TODO Auto-generated method stub
				CurrentAction = 0;
				MyEvents.gather = true;
				TextField1.text = "Собираем урожай"; 
			}

			protected function application1_clickHandler(event:MouseEvent):void
			{
				// TODO Auto-generated method stub
				//image1_clickHandler(event);
			}
			
			//protected class point
			private function turnPoint(p:Point):Point
			{
				var cos:Number = 0.707;
				var sin:Number = 0.707;
				return new Point( int((cos*p.x-sin*p.y) * 1.9 - 115) , int((sin*p.x+cos*p.y) - 345));
			}
			private function unTurnPoint(p:Point):Point
			{
				var cos:Number = 0.707;
				var sin:Number = -0.707;
				p.x += 115;
				p.x /= 1.9;
				p.y += 345;
				return new Point( int(cos*p.x-sin*p.y) , int(sin*p.x+cos*p.y));
			}

			protected function image1_clickHandler(event:MouseEvent):void
			{
				var maxX:Number = 691; //691
				var maxY:Number = 362; //362
				var startX:Number = 64;
				var startY:Number = 57;
				var part:Number = 260; //195
				var partCount:Number = 6;
				var partX:Number = part/partCount;
				var partY:Number = part/partCount;
				var i:Number;
				var j:Number;
				var p:Point = new Point;
				var figureTest:Figure; 
				
				/*if(CurrentAction == 0)
				{
					CurrentAction = 3;
					for(i = 0; i < partCount; i++)
					{
						for(j = 0; j < partCount; j++)
						{							
							p.x = (maxX/2) + startX + partX * i;
							p.y = startY + partY * j;
							p = turnPoint(p);
							figureTest = new Figure(p, CurrentAction);
							arrFigures.push(figureTest);
							this.parent.addChild(figureTest);
						}
					}
					CurrentAction = 0;
				}*/
				if(CurrentAction > 0)
				{
					p.x = event.stageX;
					p.y = event.stageY - 130/2;
					p = unTurnPoint(p);
					if(p.x > (maxX/2) + startX && p.x < (maxX/2) + startX + part
						&& p.y > startY && p.y < startY + part)
					{
						p.x -= startX;
						p.y -= startY;
						p.x = int(int(p.x/partX)*partX);
						p.y = int(int(p.y/partY)*partY);
						p.x += startX;
						p.y += startY;
						p = turnPoint(p);
						figureTest = new Figure(p, CurrentAction);
						arrFigures.push(figureTest);
						this.parent.addChild(figureTest);
					}
					else
					{
						TextField1.text = "false" + p;
					}
				}
			}


			protected function application1_activateHandler(event:Event):void
			{
			}


			protected function button3_clickHandler(event:MouseEvent):void
			{
				//Alert.show("Растут: " + arrFigures.length);
				arrFigures.forEach(growFigure);
			}
			
			private function growFigure(element:Figure, index:int, arr:Array):void
			{
				//TextField1.text = "" + index;
				//arr.splice(index, 1);
				//this.parent.removeChild(element);
				element.grow();
			}

		]]>
	</fx:Script>

	<s:states>
		<s:State name="State1"/>
	</s:states>
	<fx:Declarations>
		<!-- Разместить невизуальные элементы (например, службы или объекты значений) -->
	</fx:Declarations>
	<s:Button x="881.25" y="9.9" label="Посадить картошку" width="150" id="PlantPotato" click="PlantPotato_clickHandler(event)"/>
	<s:Button x="881.25" y="38.9" label="Посадить подсолнух" width="150" click="button1_clickHandler(event)"/>
	<s:Button x="881.25" y="67.9" label="Посадить клевер" width="150" click="button2_clickHandler(event)"/>
	<s:Button x="881.25" y="96.9" label="Собрать" width="150" click="button4_clickHandler(event)"/>
	<s:Button x="881.25" y="125.9" label="Рости" width="150" click="button3_clickHandler(event)"/>
	<mx:Image x="0" y="0" source="../assets/BG.jpg" width="862" height="500" click="image1_clickHandler(event)"/>
	<s:TextInput y="154" width="144" id="TextField1" x="881"/>
	<s:SkinnableContainer x="895" y="290" width="106" height="179">
		<mx:Image x="1" source="../assets/sunflower/Images/Image 9.png" scaleContent="false" width="100" height="130" y="30" z="0" bottom="0"/>
	</s:SkinnableContainer>
</s:Application>
